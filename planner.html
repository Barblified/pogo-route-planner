// Get road-based routing from OSRM
const waypoints = result.route.map(point => `${point.lng},${point.lat}`).join(';');
const osrmUrl = `https://router.project-osrm.org/route/v1/walking/${waypoints}?overview=full&geometries=geojson`;

fetch(osrmUrl)
    .then(response => response.json())
    .then(data => {
        if (data.routes && data.routes[0]) {
            const coords = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
            routeLine = L.polyline(coords, {
                color: '#667eea',
                weight: 4,
                opacity: 0.7
            }).addTo(map);
            
            // Update actual distance with road-based distance
            const roadDistance = data.routes[0].distance / 1000; // Convert to km
            document.getElementById('actual-distance').textContent = roadDistance.toFixed(2);
            document.getElementById('efficiency').textContent = 
                (result.stopsVisited / roadDistance).toFixed(2);
            
            // Fit map to route
            map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
        }
    })
    .catch(error => {
        console.error('Routing error:', error);
        // Fallback to straight lines if routing fails
        const routeCoords = result.route.map(point => [point.lat, point.lng]);
        routeLine = L.polyline(routeCoords, {
            color: '#667eea',
            weight: 4,
            opacity: 0.7,
            dashArray: '5, 10'
        }).addTo(map);
        map.fitBounds(routeLine.getBounds(), { padding: [50, 50] });
    });
